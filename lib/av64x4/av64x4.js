class AvCustom64{constructor(e){if(65!==e.length)throw new Error("Encode str must have 65 bytes");this.map=e}encode(e){e=this._utf8_encode(e);for(var t,r,a,o,c,n,h,_="",i=0;i<e.length;)o=(t=e.charCodeAt(i++))>>2,c=(3&t)<<4|(r=e.charCodeAt(i++))>>4,n=(15&r)<<2|(a=e.charCodeAt(i++))>>6,h=63&a,isNaN(r)?n=h=64:isNaN(a)&&(h=64),_+=this.map.charAt(o)+this.map.charAt(c)+this.map.charAt(n)+this.map.charAt(h);return _}decode(e){e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var t,r,a,o,c,n,h="",_=0;_<e.length;)t=this.map.indexOf(e.charAt(_++))<<2|(o=this.map.indexOf(e.charAt(_++)))>>4,r=(15&o)<<4|(c=this.map.indexOf(e.charAt(_++)))>>2,a=(3&c)<<6|(n=this.map.indexOf(e.charAt(_++))),h+=String.fromCharCode(t),64!=c&&(h+=String.fromCharCode(r)),64!=n&&(h+=String.fromCharCode(a));return this._utf8_decode(h).replace(/[\u0000-\u0019]+/g,"").replace(/\\n/g,"\\n").replace(/\\'/g,"\\'").replace(/\\"/g,'\\"').replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f")}_utf8_encode(e){e=e.replace(/\r\n/g,"\n");for(var t,r="",a=0;a<e.length;a++)(t=e.charCodeAt(a))<128?r+=String.fromCharCode(t):t>127&&t<2048?(r+=String.fromCharCode(t>>6|192),r+=String.fromCharCode(63&t|128)):(r+=String.fromCharCode(t>>12|224),r+=String.fromCharCode(t>>6&63|128),r+=String.fromCharCode(63&t|128));return r}_utf8_decode(e){for(var t="",r=0,a=0;r<e.length;)(a=e.charCodeAt(r))<128?(t+=String.fromCharCode(a),r++):a>191&&a<224?(t+=String.fromCharCode((31&a)<<6|63&e.charCodeAt(r+1)),r+=2):(t+=String.fromCharCode((15&a)<<12|(63&e.charCodeAt(r+1))<<6|63&e.charCodeAt(r+2)),r+=3);return t}}const av_char_uppercase="ABCDEFGHIJKLMNOPQRSTUVWXYZ",av_char_lowercase="abcdefghijklmnopqrstuvwxyz",av_char_numbers="0123456789",av_char_symbols="%/&",av_char_split="$",av_char_64=av_char_uppercase+av_char_lowercase+"0123456789%/&",av_custom64=new AvCustom64(av_char_64),av_tables=[],av_tables_functions=[e=>{let t=[];for(let r=0;r<e.length;r++)for(let a=0;a<e[r].length;a++)t.push(av_char_64[e[r][a]]);return t},e=>{let t=[];for(let r=e.length-1;r>=0;r--)for(let a=e[r].length-1;a>=0;a--)t.push(av_char_64[e[r][a]]);return t},e=>{let t=[],r=[];for(let a=0;a<e.length;a++)for(let o=0;o<e[a].length;o++)e[a][o]%2==0?r.push(av_char_64[e[a][o]]):t.push(av_char_64[e[a][o]]);return t.concat(r)},e=>{let t=[],r=[];for(let a=0;a<e.length;a++)for(let o=0;o<e[a].length;o++)e[a][o]%2==0?t.push(av_char_64[e[a][o]]):r.push(av_char_64[e[a][o]]);return t.concat(r)}],av_fetch_index=(e,t,r,a)=>{let o=parseInt(a.indexOf(t)),c=parseInt(e),n="+"===r?o+c:o-c;return n<0&&(n+=64),n>64&&(n-=64),n};function av_mtx(e,t){var r,a,o=[];for(r=0,a=-1;r<e.length;r++)r%t==0&&(o[++a]=[]),o[a].push(e[r]);return o}function av_create_buffer(e){let t=new Array(65),r=[],a=[],o=[],c=[];for(let t=0,r=e.split("");t<r.length;t++)if(0!==t){let e=null;e=t%4!=0?""+r[t]+r[t-1]:""+r[t],-1===c.indexOf(e)&&c.push(e)}for(let e=0;e<t.length;e++)t[e]=e,-1===c.indexOf(JSON.stringify(t[e]))?parseInt(t[e])%2==0?o.push(t[e]):a.push(t[e]):r.push(t[e]);return av_mtx([].concat(r,a,o),8)}const av_core={start:e=>{String.prototype.includes||(String.prototype.includes=function(e,t){"use strict";return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)});for(let t=0;t<av_tables_functions.length;t++)av_tables[t]=av_tables_functions[t](e)},create_key:e=>av_custom64.encode(e).split("").map(e=>av_char_64.indexOf(e)).join(""),create_buffer:e=>av_create_buffer(e),encode64:e=>av_custom64.encode(e),decode64:e=>av_custom64.decode(e),define_key:(e,t)=>{for(;e.length<t.length;)e+=e;return e},apply:(e,t,r)=>{let a="",o=t.split(""),c=e.split("");for(let e=1;e<=t.length;e++)a+="encode"===r?av_tables[e%4][av_fetch_index(c[e-1],o[e-1],"+",av_char_64.split(""))]:av_char_64.split("")[av_fetch_index(c[e-1],o[e-1],"-",av_tables[e%4])];return a},get_date:()=>JSON.stringify((new Date).getTime()),parse_date:e=>new Date(parseInt(e)),fake_date:e=>JSON.stringify(new Date(parseInt(e)).getTime()),mix:(e,t)=>`${e}$${t}`,split:e=>e.split("$")};export class AV64X4{constructor(e){e&&this.init(e)}init(e){const t=av_core.create_key(e),r=av_core.create_buffer(t),a=av_core.create_key("timestamp");this["[[av_key]]"]=t,this["[[av_date]]"]=a,av_core.start(r)}encode(e,t=null){this._doCheck("encode");try{let r=av_core.encode64(e),a=t?av_core.fake_date(t):av_core.get_date(),o=av_core.define_key(this["[[av_key]]"],r),c=av_core.define_key(this["[[av_date]]"],a);return av_core.mix(av_core.apply(o,r,"encode"),av_core.apply(c,a,"encode"))}catch(e){throw new Error("Encode failed.")}}decode(e){this._doCheck("decode");try{let t=av_core.split(e)[0],r=av_core.define_key(this["[[av_key]]"],t),a=av_core.apply(r,t,"decode");return av_core.decode64(a)}catch(e){throw new Error("Decode failed.")}}when(e){this._doCheck("check when");try{let t=av_core.split(e)[1],r=av_core.define_key(this["[[av_date]]"],t),a=av_core.apply(r,t,"decode");return av_core.parse_date(a)}catch(e){throw new Error("When failed.")}}_doCheck(e){if(!this["[[av_key]]"])throw new Error(`Cannot ${e} before initiation. Call AV64X4.init("your_key")`)}}export const encode64=e=>av_core.encode64(e);export const decode64=e=>av_core.decode64(e);